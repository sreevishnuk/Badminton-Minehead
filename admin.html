<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="styles.css">

  <!-- âœ… SECURITY GUARD (Ultra Safe Version) -->
  <script type="module">
    console.log("[SECURITY] Starting auth check...");

    try {
      // Import Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyBQvr257MnUMdv-i4VkgjaGUPnSho3F_x0",
        authDomain: "minehead-badminton-tournament.firebaseapp.com",
        projectId: "minehead-badminton-tournament",
        storageBucket: "minehead-badminton-tournament.appspot.com",
        messagingSenderId: "237720155580",
        appId: "1:237720155580:web:8faed76ef425f262d727b9",
        measurementId: "G-RG7J53MLE2"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      console.log("[SECURITY] Firebase initialized.");

      // Wait a tiny bit to ensure auth state is ready (optional but helpful)
      setTimeout(() => {
        onAuthStateChanged(auth, (user) => {
          if (user) {
            console.log("[SECURITY] User is logged in:", user.email);
          } else {
            console.log("[SECURITY] No user detected. Redirecting to adminlogin.html...");
            window.location.href = 'adminlogin.html';
          }
        });
      }, 500);

    } catch (err) {
      console.error("[SECURITY CRITICAL ERROR]", err);
      alert("Security check failed. Please contact administrator.");
    }
  </script>
</head>
<body class="admin-bg">
  <nav class="admin-nav">
    <img src="badmintonlogo.png" alt="Badminton Logo" class="logo-sm" />
    <span class="admin-title">Admin Dashboard</span>
    <button class="btn-secondary" onclick="logoutAdmin()">Logout</button>
  </nav>

  <div class="admin-container">
    <section>
      <button class="btn-primary" onclick="toggleRegistration()">Enable/Disable Registration</button>
      <button class="btn-accent" onclick="generateFixtures()">Generate Fixtures</button>
    </section>

    <section>
      <h2>Player Control</h2>
      <div id="players-list">Loading players...</div>
    </section>

    <section>
      <h2>Manage Fixtures</h2>
      <div id="edit-fixtures">Loading fixtures...</div>
    </section>

    <section>
      <h2>Fixtures & Results</h2>
      <div id="enter-scores">Loading score entry...</div>
    </section>
  </div>

  <script src="script.js" type="module"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof loadPlayers === 'function') loadPlayers();
      if (typeof loadFixturesAdmin === 'function') loadFixturesAdmin();
    });
  </script>
</body>
</html>
